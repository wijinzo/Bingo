<!DOCTYPE html>

<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <title>Bingo Creator</title>
    <style>
        :root {
            --primary-color: #2dd4bf;
            --secondary-color: #0f766e;
            --background-color: #f8fafc;
            --text-color: #334155;
            --accent-color: #f59e0b;
            --error-color: #ef4444;
            --success-color: #10b981;
            --border-radius: 12px;
            --cell-size: clamp(60px, 5vw, 80px);
            --grid-gap: 4px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background-color: #f0f2f5;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            padding: 20px;
            min-height: 100vh;
            gap: 20px;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            text-align: center;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            text-align: center;
            margin: 0;
            flex: 1;
        }

        .return-button {
            color: white;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            transition: color 0.2s, transform 0.2s;
            margin-right: 10px;
            text-decoration: none;
        }

        .return-button:hover {
            color: var(--accent-color);
            transform: scale(1.15) rotate(-8deg);
            text-decoration: none;
        }

        .instructions {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
            max-width: 80%;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }


        .instructions-icon {
            font-size: 24px;
            color: var(--primary-color);
            flex-shrink: 0;
        }

        .instructions-text {
            font-size: 14px;
            color: var(--text-color);
        }

        .instructions-text p {
            margin-bottom: 5px;
            text-align: left
        }

        .close-instructions {
            cursor: pointer;
            padding: 5px;
            color: var(--text-color);
            transition: all 0.2s ease;
        }

        .close-instructions:hover {
            color: var(--primary-color);
            transform: scale(1.1);
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .control-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(45, 212, 191, 0.3);
            transition: all 0.3s ease;
        }

        .control-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(45, 212, 191, 0.4);
        }

        .control-button.secondary {
            background: white;
            color: var(--secondary-color);
            border: 2px solid var(--secondary-color);
        }

        .main-container {
            display: flex;
            gap: 20px;
            width: 100%;
            max-width: 1600px;
            margin-top: 70px;
        }

        .left-container {
            flex: 1;
            max-width: 400px;
            min-width: 350px;
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            overflow-y: auto;
            height: calc(100vh - 100px);
            display: flex;
            justify-content: center;
            align-items: center;
            position: sticky;
            top: 90px;
            flex-direction: column;
        }

        .bingo-title-container button#uploadBingoTitle {
            padding: 10px 16px;
            font-size: 14px;
            border-radius: 50px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: bold;
            border: none;
            box-shadow: 0 4px 10px rgba(45, 212, 191, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }



        .grid-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1;
            background: white;
            border-radius: var(--border-radius);
            border: 4px solid var(--secondary-color);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }



        .grid-wrapper {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            padding: 15px;
            width: 100%;
            height: 100%;
            /*margin-top: 2%;*/
            margin-bottom: 2%;
        }

        .cell {
            background: rgba(243, 244, 246, 0.8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }


        .cell.filled {
            border: 2px solid var(--primary-color);
        }

        .cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cell .upload-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #9ca3af;
        }

        .cell .title-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 5px;
            font-size: 10px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .cell:hover .title-overlay {
            opacity: 1;
        }

        .right-container {
            flex: 2;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            max-width: 1200px;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow-y: auto;
            height: calc(100vh - 100px);
        }

        .entry {
            height: 100%;
            background: white;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .entry-control-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
            align-items: stretch;

        }

        .entry-control-buttons .control-button .entry-control-buttons .control-button.secondary {
            width: 100%;

        }

        .entry:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .entry-header {
            background: var(--background-color);
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            color: var(--secondary-color);
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .entry-number {
            background: var(--primary-color);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .entry-img-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .entry img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .entry img:hover {
            transform: scale(1.05);
        }

        .entry-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
        }

        .input-container {
            flex: 1 1 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            position: relative;
            margin-top: 10px;
        }

        .input-label {
            position: absolute;
            left: 12px;
            top: -8px;
            background: white;
            padding: 0 5px;
            font-size: 12px;
            color: var(--secondary-color);
            z-index: 1;
        }

        .input[type="text"] {
            text-align: left;
            padding: 8px;
            line-height: 1;
            /* Ê≠£Â∏∏ÁöÑË°åÈ´ò */
            vertical-align: baseline;
            /* ÊÅ¢Âæ©Âü∫Á∑öÂ∞çÈΩä */
        }

        .entry input[type="text"],
        .entry textarea {
            flex: 1 1 0;
            min-height: 0;
            resize: none;
            width: 100%;
            padding: 12px;
            font-size: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            transition: all 0.3s ease;
            resize: none;
            height: 80px;
        }

        textarea[id^="answer-desc-"] {
            height: 50px !important;
            min-height: 50px !important;
            max-height: 50px !important;
            resize: none;
        }

        .entry input[type="text"]:hover,
        .entry textarea:hover,
        .entry input[type="text"]:focus,
        .entry textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.2);
        }


        .entry input[type="file"] {
            display: none;
        }

        .entry label {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
            width: 100%;
            text-align: center;
        }

        .entry label:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 212, 191, 0.3);
        }

        .character-count {
            font-size: 12px;
            color: #9ca3af;
            text-align: right;
            margin-top: 5px;
        }

        .display-area {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            /* ÂïüÁî®ÂûÇÁõ¥ÊªæÂãïÊ¢ù */
            overflow-x: hidden;
            /* Èö±ËóèÊ∞¥Âπ≥ÊªæÂãïÊ¢ù */
        }

        .display-area img {
            max-width: 100%;
            max-height: 70vh;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .display-area .text-content {
            font-size: 16px;
            color: #333;
            max-height: 20vh;
            overflow-y: auto;
            padding: 10px;
            background: var(--background-color);
            border-radius: 8px;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            line-height: 1.4;
        }

        .display-area .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        .display-area .close-button:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(3px);
            z-index: 999;
        }

        .notification {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification.error {
            background: var(--error-color);
        }

        .display-area .text-content h2 {
            font-size: 1.25em;
            color: var(--secondary-color);
            margin: 8px 0 4px 0;
        }

        .display-area .text-content strong {
            font-weight: 700;
            color: var(--secondary-color);
        }


        .display-area .text-content p {
            margin: 4px 0;
            /* Ê∏õÂ∞ëÊÆµËêΩÈñìË∑ù */
        }

        .bingo-title-container {
            margin-bottom: 15px;
            width: 100%;
        }

        .bingo-title-container input {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background: white;
            transition: all 0.3s ease;
            color: var(--secondary-color);
            font-weight: bold;
            text-align: center;
        }

        .bingo-title-container input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.2);
        }

        .bingo-title-container .character-count {
            text-align: right;
            font-size: 12px;
            color: #9ca3af;
            margin-top: 4px;
        }

        /* ÈüøÊáâÂºèË™øÊï¥ */
        @media (max-width: 1200px) {
            .main-container {
                flex-direction: column;
            }

            .left-container {
                max-width: 100%;
                position: relative;
                top: 0;
                height: auto;
                min-height: 400px;
            }

            .right-container {
                max-width: 100%;
                height: auto;
            }

            .grid-container {
                aspect-ratio: 1/1;
                max-width: 500px;
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            .instructions {
                max-width: 95%;
            }

            .grid-wrapper {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(8, 1fr);
            }

            .entry {
                padding: 10px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .control-button {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>


</head>

<body>
    <div class="header">
        <a href="creator_dashboard.html" class="return-button">
            <i class="bi bi-arrow-left-circle"></i>
        </a>
        <h1>Bingo Ë£Ω‰Ωú</h1>
        <div style="width:2.2rem"></div> <!-- ‰Ωî‰ΩçÔºåËÆìÊ®ôÈ°åËÉΩÊ≠£‰∏≠ -->

    </div>


    <div class="instructions" id="instructions">
        <div class="instructions-icon">‚ÑπÔ∏è</div>
        <div class="instructions-text">
            <align="left">
                <p>‰ΩøÁî®Ë™™ÊòéÔºö</p>
                <p>1. ÈªûÈÅ∏Âè≥ÂÅ¥ÂçÄÂüüÁöÑ„ÄåÈÅ∏ÊìáÂúñÁâá„Äç‰æÜ‰∏äÂÇ≥È°åÁõÆÂúñÁâá</p>
                <p>2. Ëº∏ÂÖ•È°åÁõÆÊ®ôÈ°åÔºàÊúÄÂ§ö50Â≠óÔºâ</p>
                <p>3. Ëº∏ÂÖ•È°åÁõÆÊïòËø∞ÔºàÊúÄÂ§ö100Â≠óÔºâ</p>
                <p>4. ‰∏äÂÇ≥ÂæåÁöÑÂúñÁâáÊúÉËá™ÂãïÈ°ØÁ§∫Âú®Â∑¶ÂÅ¥ÁöÑË≥ìÊûúÂç°Áâá‰∏≠</p>
                <p>5. ÈªûÈÅ∏Ë≥ìÊûúÂç°ÁâáÁöÑÊ†ºÂ≠êÂèØ‰ª•Ê™¢Ë¶ñÂ§ßÂúñÂíåË©≥Á¥∞‰ªãÁ¥π</p>
                </align>
        </div>
        <div class="close-instructions" id="close-instructions">‚úï</div>
    </div>

    <div class="main-container">
        <div class="left-container">
            <div class="grid-container">
                <div class="grid-wrapper" id="grid-wrapper">
                    <!-- Grid cells will be generated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="right-container" id="uploadArea">
            <!-- Upload entries will be generated by JavaScript -->
        </div>
    </div>

    <div class="controls">
        <button class="control-button secondary" id="resetButton">ÈáçÁΩÆ</button>
        <button class="control-button" id="downloadButton">‰∏äÂÇ≥</button>
        <button class="control-button secondary" id="showInstructionsButton">È°ØÁ§∫Ë™™Êòé</button>
    </div>

    <div class="notification" id="notification">Êìç‰ΩúÊàêÂäüÔºÅ</div>
    <div class="overlay" id="overlay"></div>
    <div class="display-area" id="displayArea">
        <div class="close-button" id="closeDisplay">‚úï</div>
        <img id="displayImg" src="" alt="Ë≥ìÊûúÈ†ÖÁõÆ">
        <div class="text-content" id="displayTitle"></div>
        <div class="text-content" id="displayText"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const editingBingoId = urlParams.get("id"); //Ê†πÊìöÁ∂≤ÂùÄÂèÉÊï∏ËÆÄÂèñ Bingo ID

            const GRID_SIZE = 3;
            const TOTAL_CELLS = GRID_SIZE * GRID_SIZE;
            const MAX_TITLE_LENGTH = 50;
            const MAX_DESC_LENGTH = 1000;

            const gridWrapper = document.getElementById("grid-wrapper");
            const uploadArea = document.getElementById("uploadArea");
            const overlay = document.getElementById("overlay");
            const displayArea = document.getElementById("displayArea");
            const displayImg = document.getElementById("displayImg");
            const displayTitle = document.getElementById("displayTitle");
            const displayText = document.getElementById("displayText");
            const closeDisplay = document.getElementById("closeDisplay");
            const notification = document.getElementById("notification");
            const instructions = document.getElementById("instructions");
            const closeInstructions = document.getElementById("close-instructions");
            const showInstructionsButton = document.getElementById("showInstructionsButton");
            const resetButton = document.getElementById("resetButton");
            const downloadButton = document.getElementById("downloadButton");

            const articleImageMap = new Map(); // key = index, value = base64 string

            // Êñ∞Â¢û Bingo Ê®ôÈ°åËº∏ÂÖ•ÂçÄÂ°ä
            const bingoTitleContainer = document.createElement("div");
            bingoTitleContainer.className = "bingo-title-container";
            bingoTitleContainer.style.display = "flex";
            bingoTitleContainer.style.gap = "10px";
            bingoTitleContainer.style.alignItems = "center";

            bingoTitleContainer.innerHTML = `
    <div style="display: flex; flex-direction: column; gap: 10px; width: 100%;">
        <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" id="bingoTitle" maxlength="20" placeholder="Ëº∏ÂÖ• Bingo Ê®ôÈ°å">
            <div class="character-count" id="bingoTitle-count">0/20</div>
        </div>
        <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" id="bingoRegion" maxlength="100" placeholder="Âú∞Èªû">
            <div class="character-count" id="bingoRegion-count">0/100</div>
        </div>
        <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" inputmode="numeric" maxlength="4" id="bingoReward" placeholder="ÁçéÂãµÈªûÊï∏">
            <div class="character-count" id="bingoReward-count">0/4</div>
            <input type="text" inputmode="numeric" maxlength="1" id="bingoPasslimit" placeholder="ÈÄöÈÅéÊï∏Èáè">
            <div class="character-count" id="bingoPasslimit-count">0/1</div>
        </div>
        <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" id="hashtag" maxlength="50" placeholder="Hashtag (ÈÅ∏Â°´)">
            <div class="character-count" id="hashtag-count">0/100</div>
        </div>
    </div>
`;

            // ÊèíÂÖ•Âà∞Â∑¶ÂÅ¥ .left-container ÁöÑÊúÄ‰∏äÊñπ
            const leftContainer = document.querySelector('.left-container');
            leftContainer.insertBefore(bingoTitleContainer, leftContainer.firstChild);

            // ÂãïÊÖãË®àÁÆóÂ≠óÊï∏
            const bingoTitleInput = document.getElementById('bingoTitle');
            const bingoRegionInput = document.getElementById('bingoRegion');
            const bingoRewardInput = document.getElementById('bingoReward');
            const bingoPasslimitInput = document.getElementById('bingoPasslimit');
            const hashtagInput = document.getElementById('hashtag');

            bingoTitleInput.addEventListener('input', () => {
                const count = bingoTitleInput.value.length;
                document.getElementById('bingoTitle-count').textContent = `${count}/20`;
            });
            bingoRegionInput.addEventListener('input', () => {
                const count = bingoRegionInput.value.length;
                document.getElementById('bingoRegion-count').textContent = `${count}/100`;
            });
            bingoRewardInput.addEventListener('input', () => {
                bingoRewardInput.value = bingoRewardInput.value.replace(/\D/g, '').slice(0, 4);
                const count = bingoRewardInput.value.length;
                document.getElementById('bingoReward-count').textContent = `${count}/4`;
            });
            bingoPasslimitInput.addEventListener('input', () => {
                bingoPasslimitInput.value = bingoPasslimitInput.value.replace(/\D/g, '').slice(0, 1);
                const count = bingoPasslimitInput.value.length;
                document.getElementById('bingoPasslimit-count').textContent = `${count}/1`;
            });
            
            hashtagInput.addEventListener('input', () => {
                const count = hashtagInput.value.length;
                document.getElementById('hashtag-count').textContent = `${count}/20`;
            });

            // È°ØÁ§∫ÂçÄÂ°äÔºàÈ°ØÁ§∫Âú®Ë≥ìÊûúÂç°‰∏äÊñπÔºâ
            const titleDisplay = document.createElement('div');
            titleDisplay.id = 'bingoTitleDisplay';
            titleDisplay.style.textAlign = 'center';
            titleDisplay.style.fontWeight = 'bold';
            titleDisplay.style.color = 'var(--secondary-color)';
            titleDisplay.style.marginBottom = '10px';
            titleDisplay.style.fontSize = '20px';
            leftContainer.insertBefore(titleDisplay, leftContainer.children[1]);

            //Â¶ÇÊûúÊúâÁ∑®ËºØÁöÑ Bingo IDÔºåÂâáËºâÂÖ•Ë©≤ Bingo ÁöÑË≥áÊñô
            if (editingBingoId) {
                loadBingoForEdit(editingBingoId);
                downloadButton.textContent = "ÂÑ≤Â≠ò";
                downloadButton.removeEventListener('click', handleUploadAll);
                downloadButton.addEventListener('click', () => updateUploadAll(editingBingoId));
            } else {
                //ÂØ¶‰ΩúdownloadButtonÔºå‰∏ÄÊ¨°‰∏äÂÇ≥ÊâÄÊúâË≥áÊñô
                downloadButton.addEventListener('click', handleUploadAll);
            }

            closeDisplay.addEventListener('click', () => {
                displayArea.style.display = 'none';
                overlay.style.display = 'none';
            });
            overlay.addEventListener('click', () => {
                displayArea.style.display = 'none';
                overlay.style.display = 'none';
            });
            closeInstructions.addEventListener('click', () => instructions.style.display = 'none');
            resetButton.addEventListener('click', () => {
                if (confirm('Á¢∫ÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÂÖßÂÆπÂóéÔºü')) {
                    initializeGrid();
                    initializeUploadArea();

                }
            });



            initializeGrid();
            initializeUploadArea();

            function initializeGrid() {
                gridWrapper.innerHTML = '';
                for (let i = 0; i < TOTAL_CELLS; i++) {
                    const cell = document.createElement("div");
                    cell.className = "cell";
                    cell.setAttribute("data-id", i);
                    cell.innerHTML = `<div class="upload-icon">+</div>`;
                    gridWrapper.appendChild(cell);

                    cell.addEventListener("click", () => {
                        const cellImg = cell.querySelector('img');
                        if (cellImg) {
                            const entry = document.querySelector(`.entry[data-id="${i * 2}"]`);
                            const descEntry = document.querySelector(`.entry[data-id="${i * 2 + 1}"]`);
                            if (entry && descEntry) {
                                const nameInput = entry.querySelector('input[type="text"]');
                                const locaInput = descEntry.querySelector('textarea[id^="loca-desc-"]');
                                const textInput = descEntry.querySelector('textarea[id^="topic-desc-"]');
                                if (nameInput && textInput && locaInput) {
                                    displayTitle.innerHTML = `<h1><strong>${nameInput.value}</strong></h1>`;
                                    displayText.innerHTML = `<h2>ÊôØÈªû‰ªãÁ¥π</h2><p>${locaInput.value}</p><h2>È°åÁõÆË™™Êòé</h2><p>${textInput.value}</p>`;
                                    displayImg.src = cellImg.src;
                                    displayArea.style.display = 'block';
                                    overlay.style.display = 'block';
                                }
                            }
                        }
                    });
                }
            }

            function initializeUploadArea() {
                uploadArea.innerHTML = '';
                for (let i = 0; i < TOTAL_CELLS * 2; i++) {
                    const currentNum = Math.floor(i / 2) + 1;
                    const entry = document.createElement("div");
                    entry.className = "entry";
                    entry.setAttribute("data-id", i);
                    if (i % 2 === 0) {
                        entry.innerHTML = `
                        <div class="entry-header">
                            <div>ÂúñÁâá‰∏äÂÇ≥</div>
                            <div class="entry-number">${currentNum}</div>
                        </div>
                        <div class="entry-img-container">
                            <img src="https://via.placeholder.com/300?text=Upload+Image" alt="‰∏äÂÇ≥ÂúñÁâá" id="preview-${i}">
                        </div>
                        <div class="entry-form">
                            <input type="file" accept="image/*" id="file-${i}" style="display: none;">
                            <label for="file-${i}">ÈÅ∏ÊìáÂúñÁâá</label>
                            <div class="input-container">
                                <div class="input-label">Ê®ôÈ°å</div>
                                <input type="text" id="title-${i}" maxlength="${MAX_TITLE_LENGTH}" placeholder="Ë´ãËº∏ÂÖ•ÂúñÁâáÊ®ôÈ°å">
                                <div class="character-count" id="title-${i}-count">0/${MAX_TITLE_LENGTH}</div>
                            </div>
                        </div>`;

                        entry.querySelector(`#file-${i}`).addEventListener("change", handleFileUpload);
                    } else {
                        entry.innerHTML = `
                        <div class="entry-header">
                            <div>ÂÖßÂÆπÊïòËø∞</div>
                            <div class="entry-number">${currentNum}</div>
                        </div>
                        <div class="input-container">
                            <div class="input-label">ÊôØÈªû/ÁâπËâ≤‰ªãÁ¥π</div>
                            <textarea id="loca-desc-${i}" maxlength="${MAX_DESC_LENGTH}" placeholder="Ë´ãËº∏ÂÖ•ÊôØÈªûÊïòËø∞"></textarea>
                            <div class="character-count" id="loca-desc-${i}-count">0/${MAX_DESC_LENGTH}</div>
                        </div>
                        <div class="input-container">
                            <div class="input-label">È°åÁõÆÊïòËø∞</div>
                            <textarea id="topic-desc-${i}" maxlength="${MAX_DESC_LENGTH}" placeholder="Ë´ãËº∏ÂÖ•È°åÁõÆÊïòËø∞"></textarea>
                            <div class="character-count" id="topic-desc-${i}-count">0/${MAX_DESC_LENGTH}</div>
                        </div>
                        
                        <div class="input-container">
                            <div class="input-label">Á≠îÊ°à</div>
                            <textarea id="answer-desc-${i}" maxlength="1" placeholder="Ë´ãËº∏ÂÖ•Á≠îÊ°àÁöÑÈÅ∏È†Ö‰ª£ËôüÔºå‰æãÂ¶ÇA" style="height:10px;"></textarea>                            <div class="character-count" id="answer-desc-${i}-count">0/${1}</div>
                        </div>
                        
                        
                        
                            
                        <div class="entry-control-buttons" >
                            <button class="control-button secondary">Âà™Èô§</button>
                        </div >`;
                    }// reward&location Ê¨Ñ‰ΩçÁßªÈô§ÔºåÊîπÁÇ∫Êï¥È´î Bingo Ë®≠ÂÆö
                    uploadArea.appendChild(entry);
                    const inputs = entry.querySelectorAll('input[type="text"], textarea');
                    inputs.forEach(input => {
                        input.addEventListener('input', handleInputCount);
                    });

                    // Âú® initializeUploadArea() Ë£°ÔºåÊØèÊ¨°Âª∫Á´ã entry ÂæåÂä†ÈÄôÊÆµ
                    const answerInput = entry.querySelector(`textarea[id^="answer-desc-"]`);
                    if (answerInput) {
                        answerInput.addEventListener('input', function () {
                            // Âè™ÂÖÅË®±Ëº∏ÂÖ•Â§ßÂØ´ A~D
                            let val = answerInput.value.toUpperCase().replace(/[^ABCD]/g, '');
                            // Âè™ÂèñÁ¨¨‰∏ÄÂÄãÂ≠óÂÖÉÔºàÂõ† maxlength=1Ôºâ
                            answerInput.value = val.slice(0, 1);
                            // Êõ¥Êñ∞Â≠óÊï∏È°ØÁ§∫
                            const countDisplay = document.getElementById(`${answerInput.id}-count`);
                            if (countDisplay) countDisplay.textContent = `${answerInput.value.length}/1`;
                        });
                    }

                }
                uploadArea.addEventListener('click', function (e) {
                    const button = e.target.closest('button');
                    if (!button) return;

                    if (button.textContent.includes('Âà™Èô§')) {
                        handleDelete(button);
                    }
                });
            }

            //Âç≥ÊôÇÂ≠óÊï∏È°ØÁ§∫Âô® + Ë≥áÊñôÂêåÊ≠•Âô®
            function handleInputCount(e) {
                const input = e.target;
                const count = input.value.length;
                const maxLength = input.maxLength;
                const countDisplay = document.getElementById(`${input.id}-count`);
                if (countDisplay) {
                    countDisplay.textContent = `${count}/${maxLength}`;
                }
                if (input.id.startsWith('title-')) {
                    const id = input.closest('.entry').getAttribute('data-id');
                    const cell = document.querySelector(`.cell[data-id="${id}"]`);
                    const titleOverlay = cell?.querySelector('.title-overlay');
                    if (titleOverlay) {
                        titleOverlay.textContent = input.value || 'Êú™ÂëΩÂêç';
                    }
                }
            }

            // upload one for button in entry(‰∏äÂÇ≥ÂçÄ)(Âà™Èô§)
            /*function handleUpload(button) {
                const entry = button.closest('.entry');
                const dataId = parseInt(entry.getAttribute('data-id'));
                const id = Math.floor(dataId / 2);

                const imageEntry = document.querySelector(`.entry[data-id="${id * 2}"]`);
                const textEntry = document.querySelector(`.entry[data-id="${id * 2 + 1}"]`);

                const titleInput = imageEntry.querySelector('input[id^="title-"]');
                const locationInput = textEntry.querySelector('textarea[id^="location-"]');
                const locaDescInput = textEntry.querySelector('textarea[id^="loca-desc-"]');
                const topicDescInput = textEntry.querySelector('textarea[id^="topic-desc-"]');
                const answerInput = textEntry.querySelector('textarea[id^="answer-desc-"]');
                const rewardInput = textEntry.querySelector('textarea[id^="reward-desc-"]');
                const fileInput = imageEntry.querySelector('input[type="file"]');
                const cell = document.querySelector(`.cell[data-id="${id}"]`);

                const title = titleInput?.value.trim();
                const location = locationInput?.value.trim();
                const locaDesc = locaDescInput?.value.trim();
                const topicDesc = topicDescInput?.value.trim();
                const reward = rewardInput?.value.trim();
                const answer = answerInput?.value.trim();
                const file = fileInput?.files[0];

                if (!title || !location || !locaDesc || !topicDesc || !file) {
                    alert('Ë´ãÂ°´ÂØ´ÊâÄÊúâÊ¨Ñ‰Ωç‰∏¶ÈÅ∏ÊìáÂúñÁâáÔºÅ');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    const imgSrc = e.target.result;

                    // Êõ¥Êñ∞ cell ÂúñÁâáËàáÊ®ôÈ°å
                    cell.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = imgSrc;
                    cell.appendChild(img);

                    const titleOverlay = document.createElement('div');
                    titleOverlay.className = 'title-overlay';
                    titleOverlay.textContent = title;
                    cell.appendChild(titleOverlay);

                    cell.classList.add('filled');

                    showNotification('ÊñΩÂ∑•‰∏≠');
                };
                reader.readAsDataURL(file);
            }*/

            // ‰∏äÂÇ≥ÂúñÁâáËá≥Á∂≤Á´ô(ÈôêÂà∂2MB)&È†êË¶ΩÂúñÁâá
            function handleFileUpload(e) {
                const file = e.target.files[0];
                if (file) {
                    const maxSizeMB = 2; // ÂèØËá™Ë°åË™øÊï¥Â§ßÂ∞èÈôêÂà∂ÔºàÈÄôË£°ÊòØ 2MBÔºâ
                    const maxSizeBytes = maxSizeMB * 1024 * 1024;

                    if (file.size > maxSizeBytes) {
                        alert(`Ê™îÊ°àÂ§ßÂ∞èË∂ÖÈÅé ${maxSizeMB}MBÔºåË´ãÈÅ∏ÊìáËºÉÂ∞èÁöÑÊ™îÊ°à„ÄÇ`);
                        e.target.value = ''; // Ê∏ÖÁ©∫ file input
                        return;
                    }

                    const reader = new FileReader();
                    const entry = e.target.closest('.entry');
                    const id = Math.floor(entry.getAttribute('data-id') / 2);


                    reader.onload = (event) => {
                        const img = entry.querySelector('img');
                        img.src = event.target.result;
                        const targetCell = document.querySelector(`.cell[data-id="${id}"]`);
                        let cellImg = targetCell.querySelector('img');
                        if (!cellImg) {
                            cellImg = document.createElement('img');
                            targetCell.innerHTML = '';
                            targetCell.appendChild(cellImg);
                            const titleOverlay = document.createElement('div');
                            titleOverlay.className = 'title-overlay';
                            targetCell.appendChild(titleOverlay);
                        }
                        cellImg.src = event.target.result;
                        targetCell.classList.add('filled');
                    };
                    reader.readAsDataURL(file);
                }
            }

            // delete one for button in entry (‰∏äÂÇ≥ÂçÄ)
            function handleDelete(button) {

                const confirmed = confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãÈ†ÖÁõÆÂóéÔºü');
                if (!confirmed) {
                    return;
                }

                const entry = button.closest('.entry');
                const dataId = parseInt(entry.getAttribute('data-id'));
                const id = Math.floor(dataId / 2);

                const imageEntry = document.querySelector(`.entry[data-id="${id * 2}"]`);
                const textEntry = document.querySelector(`.entry[data-id="${id * 2 + 1}"]`);
                const cell = document.querySelector(`.cell[data-id="${id}"]`);

                // Ê∏ÖÈô§ cell
                if (cell) {
                    cell.innerHTML = '<div class="upload-icon">+</div>';
                    cell.classList.remove('filled');
                }

                // Ê∏ÖÁ©∫ÊâÄÊúâËº∏ÂÖ•Ê¨Ñ‰Ωç
                const inputs = [...imageEntry.querySelectorAll('input[type="text"]'), ...textEntry.querySelectorAll('textarea')];
                inputs.forEach(input => input.value = '');
                inputs.forEach(input => {
                    const count = document.getElementById(`${input.id}-count`);
                    if (count) count.textContent = `0/${input.maxLength}`;
                });

                // Ê∏ÖÈô§ÂúñÁâá
                const previewImg = imageEntry.querySelector('img');
                if (previewImg) previewImg.src = 'https://via.placeholder.com/300?text=Upload+Image';

                // ÈáçË®≠ input[type="file"] ÁöÑÂÄºÔºåÁ¢∫‰øùÂèØ‰ª•ÈáçÊñ∞ÈÅ∏Ê™î
                const fileInput = imageEntry.querySelector('input[type="file"]');
                if (fileInput) fileInput.value = '';

                //Ê∏ÖÁ©∫ Base64 Âø´Âèñ
                articleImageMap.delete(id);

                showNotification('Â∑≤Âà™Èô§È†ÖÁõÆ');

            }

            // Âú® DOMContentLoaded ‰∫ã‰ª∂ËôïÁêÜÁ®ãÂ∫èÂÖßÈÉ®Ê∑ªÂä†Ê≠§ÂáΩÊï∏
            function showNotification(message, isError = false) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.classList.toggle('error', isError);
                notification.classList.add('show');

                // 3ÁßíÂæåËá™ÂãïÈö±ËóèÈÄöÁü•
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // ‰∏äÂÇ≥ÊâÄÊúâË≥áÊñôÂà∞ÂæåÁ´Ø
            async function handleUploadAll() {
                const token = localStorage.getItem("token");
                const userId = localStorage.getItem("userId");

                if (!token || !userId) {
                    alert("Ë´ãÂÖàÁôªÂÖ•ÔºÅ");
                    window.location.href = "login.html";
                    return;
                }

                const bingoTitle = document.getElementById("bingoTitle").value.trim();
                if (!bingoTitle) {
                    alert("Ë´ãËº∏ÂÖ• Bingo Ê®ôÈ°åÔºÅ");
                    return;
                }

                const articles = [];

                for (let i = 0; i < TOTAL_CELLS; i++) {
                    const imgEntry = document.querySelector(`.entry[data-id="${i * 2}"]`);
                    const textEntry = document.querySelector(`.entry[data-id="${i * 2 + 1}"]`);

                    const titleInput = imgEntry.querySelector('input[id^="title-"]');
                    const fileInput = imgEntry.querySelector('input[type="file"]');
                    const file = fileInput?.files[0];

                    const locaDesc = textEntry.querySelector('textarea[id^="loca-desc-"]').value.trim();
                    const topicDesc = textEntry.querySelector('textarea[id^="topic-desc-"]').value.trim();
                    const answer = textEntry.querySelector('textarea[id^="answer-desc-"]').value.trim();

                    if (!titleInput.value.trim() || !locaDesc || !topicDesc || !answer) {
                        alert(`Á¨¨ ${i + 1} Ê†ºË≥áÊñô‰∏çÂÆåÊï¥ÔºåË´ãÊ™¢Êü•„ÄÇ`);
                        return;
                    }

                    let imageBase64 = '';
                    if (file) {
                        imageBase64 = await readFileAsBase64(file);
                    } else {
                        imageBase64 = null; // ‚úÖ ÂúñÁâáÁÇ∫ null Ë°®Á§∫Êú™‰∏äÂÇ≥
                    }

                    articles.push({
                        name: titleInput.value.trim(),
                        depiction: locaDesc,
                        question: topicDesc,
                        answer: answer,
                        imageBase64: imageBase64
                    });
                }

                const body = {
                    owner: parseInt(userId),
                    title: bingoTitle,
                    region: document.getElementById("bingoRegion").value.trim() || "Êú™ÊåáÂÆö",
                    reward: parseInt(document.getElementById("bingoReward").value.trim()) || 0,
                    passlimit: parseInt(document.getElementById("bingoPasslimit").value.trim()) || 0,
                    articles
                };

                try {
                    const res = await fetch("http://localhost:3000/bingo/full", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${token}`
                        },
                        body: JSON.stringify(body)
                    });

                    const result = await res.json();
                    if (res.ok) {
                        alert("Bingo Âª∫Á´ãÊàêÂäüÔºÅID: " + result.bingoId);
                        showNotification("Âª∫Á´ãÊàêÂäü üéâ");

                        // ‚úÖ Ëá™ÂãïÂ∞éÂõû dashboard È†ÅÈù¢
                        setTimeout(() => {
                            window.location.href = "creator_dashboard.html";
                        }, 1000); // Âª∂ÈÅ≤ 1 ÁßíËÆìÈÄöÁü•È°ØÁ§∫
                    } else {
                        throw new Error(result.error || "Âª∫Á´ãÂ§±Êïó");
                    }
                } catch (err) {
                    console.error(err);
                    alert("‰∏äÂÇ≥Â§±ÊïóÔºö" + err.message);
                    showNotification("Âª∫Á´ãÂ§±Êïó", true);
                }
            }

            // Â∞áÂúñÁâáÊ™îÊ°àËΩâÊàê base64
            function readFileAsBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result); // ÂõûÂÇ≥ base64 Â≠ó‰∏≤
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            //ËºâÂÖ•Á∑®ËºØÈ†ÅÈù¢
            async function loadBingoForEdit(bingoId) {
                const token = localStorage.getItem("token");

                try {
                    const res = await fetch(`http://localhost:3000/bingo/${bingoId}`, {
                        headers: {
                            Authorization: `Bearer ${token}`
                        }
                    });

                    const result = await res.json();

                    if (!res.ok) throw new Error(result.error || "ÁÑ°Ê≥ïËºâÂÖ• Bingo");

                    const bingo = result.bingo;
                    const articles = result.articles;

                    // Ë®≠ÂÆö Bingo Ê®ôÈ°å„ÄÅregion„ÄÅreward„ÄÅpasslimit
                    document.getElementById("bingoReward").value = bingo.reward;
                    document.getElementById("bingoPasslimit").value = bingo.passlimit;
                    document.getElementById("bingoRegion").value = bingo.region;
                    document.getElementById("bingoTitle").value = bingo.title;
                    document.getElementById("bingoTitleDisplay").textContent = bingo.title;

                    // ËºâÂÖ•Ê†ºÂ≠êËàá‰∏äÂÇ≥ÂçÄÂÖßÂÆπ
                    for (let i = 0; i < articles.length; i++) {
                        const article = articles[i];
                        const imgEntry = document.querySelector(`.entry[data-id="${i * 2}"]`);
                        const textEntry = document.querySelector(`.entry[data-id="${i * 2 + 1}"]`);
                        const cell = document.querySelector(`.cell[data-id="${i}"]`);

                        // ÂúñÁâá
                        const img = imgEntry.querySelector('img');
                        img.src = `data:image/jpeg;base64,${article.imageBase64}`;
                        // Â∞áÂéüÂßã base64 Â≠òÂÖ•Âø´Âèñ map
                        articleImageMap.set(i, `data:image/jpeg;base64,${article.imageBase64}`);


                        // Ê®ôÈ°å
                        imgEntry.querySelector('input[id^="title-"]').value = article.name;

                        // ÊñáÂ≠óÊ¨Ñ‰Ωç
                        textEntry.querySelector('textarea[id^="loca-desc-"]').value = article.depiction;
                        textEntry.querySelector('textarea[id^="topic-desc-"]').value = article.question;
                        textEntry.querySelector('textarea[id^="answer-desc-"]').value = article.answer;

                        // ÂêåÊ≠•Êõ¥Êñ∞Ê†ºÂ≠ê
                        cell.innerHTML = '';
                        const cellImg = document.createElement('img');
                        cellImg.src = `data:image/jpeg;base64,${article.imageBase64}`;
                        const overlay = document.createElement('div');
                        overlay.className = 'title-overlay';
                        overlay.textContent = article.name;

                        cell.appendChild(cellImg);
                        cell.appendChild(overlay);
                        cell.classList.add('filled');
                    }

                    showNotification('ÊàêÂäüËºâÂÖ• Bingo ‚úÖ');
                } catch (err) {
                    console.error(err);
                    alert("ËÆÄÂèñÂ§±ÊïóÔºö" + err.message);
                }
            }

            //Êõ¥Êñ∞‰∏äÂÇ≥Ë≥áÊñô
            async function updateUploadAll(bingoId) {
                const token = localStorage.getItem("token");
                const userId = localStorage.getItem("userId");

                if (!token || !userId) {
                    alert("Ë´ãÂÖàÁôªÂÖ•ÔºÅ");
                    window.location.href = "login.html";
                    return;
                }

                const bingoTitle = document.getElementById("bingoTitle").value.trim();
                if (!bingoTitle) {
                    alert("Ë´ãËº∏ÂÖ• Bingo Ê®ôÈ°åÔºÅ");
                    return;
                }

                const articles = [];

                for (let i = 0; i < TOTAL_CELLS; i++) {
                    const imgEntry = document.querySelector(`.entry[data-id="${i * 2}"]`);
                    const textEntry = document.querySelector(`.entry[data-id="${i * 2 + 1}"]`);

                    const titleInput = imgEntry.querySelector('input[id^="title-"]');
                    const fileInput = imgEntry.querySelector('input[type="file"]');
                    const file = fileInput?.files[0];

                    const locaDesc = textEntry.querySelector('textarea[id^="loca-desc-"]').value.trim();
                    const topicDesc = textEntry.querySelector('textarea[id^="topic-desc-"]').value.trim();
                    const answer = textEntry.querySelector('textarea[id^="answer-desc-"]').value.trim();

                    if (!titleInput.value.trim() || !locaDesc || !topicDesc || !answer) {
                        alert(`Á¨¨ ${i + 1} Ê†ºË≥áÊñô‰∏çÂÆåÊï¥ÔºåË´ãÊ™¢Êü•„ÄÇ`);
                        return;
                    }

                    let imageBase64 = '';
                    if (file) {
                        imageBase64 = await readFileAsBase64(file);
                    } else {
                        const existingBase64 = articleImageMap.get(i);
                        if (existingBase64) {
                            imageBase64 = `__EXISTING__:${existingBase64}`;
                        }
                    }


                    articles.push({
                        name: titleInput.value.trim(),
                        depiction: locaDesc,
                        question: topicDesc,
                        answer: answer,
                        imageBase64: imageBase64
                    });
                }

                const body = {
                    owner: parseInt(userId),
                    title: bingoTitle,
                    region: document.getElementById("bingoRegion").value.trim() || "Êú™ÊåáÂÆö",
                    reward: parseInt(document.getElementById("bingoReward").value.trim()) || 0,
                    passlimit: parseInt(document.getElementById("bingoPasslimit").value.trim()) || 0,
                    articles
                };

                try {
                    const res = await fetch(`http://localhost:3000/bingo/full/${bingoId}`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${token}`
                        },
                        body: JSON.stringify(body)
                    });

                    const result = await res.json();
                    if (res.ok) {
                        showNotification("ÂÑ≤Â≠òÊàêÂäü ‚úÖ");
                        setTimeout(() => {
                            window.location.href = "creator_dashboard.html";
                        }, 1000);
                    } else {
                        throw new Error(result.error || "ÂÑ≤Â≠òÂ§±Êïó");
                    }
                } catch (err) {
                    console.error(err);
                    alert("ÂÑ≤Â≠òÂ§±ÊïóÔºö" + err.message);
                    showNotification("ÂÑ≤Â≠òÂ§±Êïó", true);
                }
            }
        });
    </script>



</body>

</html>
